(("undefined"!==typeof self?self:this)["webpackChunknode_driver_0_1_0"]=("undefined"!==typeof self?self:this)["webpackChunknode_driver_0_1_0"]||[]).push([[921],{4247:function(e,t,s){"use strict";s.d(t,{P:function(){return r}});var a=s(4364);function o(e,t,s){return(t=i(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function i(e){var t=n(e,"string");return"symbol"==typeof t?t:t+""}function n(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}class r{constructor(e,t){o(this,"domainId",""),o(this,"domainName",""),o(this,"endpoint",""),o(this,"projectDomainName",""),o(this,"projectId",""),o(this,"username",""),o(this,"password",""),o(this,"token",""),o(this,"region",""),o(this,"catalog",void 0),o(this,"endpoints",void 0),o(this,"userId",""),o(this,"$dispatch",void 0),o(this,"regionsFromCatalog",[]),t.annotations?Object.keys(t.annotations).forEach((e=>{const s=e.split("/");if(2===s.length&&"viarezo.cattle.io"===s[0]){const a=s[1];this[a]=t.annotations[e]}})):Object.keys(t).forEach((e=>{this[e]=t[e]})),this.$dispatch=e.dispatch}async getToken(){const e=this.endpoint.replace(/^https?:\/\//,""),t=`/meta/proxy/${e}`,s=`${t}/auth/tokens`,o={auth:{identity:{methods:["password"],password:{user:{name:this.username,domain:{name:this.domainName},password:this.password}}}}};this.projectId&&(o.auth.scope={project:{id:this.projectId}});const i={Accept:"application/json"};try{const e=await this.$dispatch("management/request",{url:s,headers:i,method:"POST",redirectUnauthorized:!1,data:o},{root:!0});if(502===e._status)return{error:"Could not proxy request - URL may not be in Rancher's allow list"};const t=e._headers["x-subject-token"];return this.token=t,this.userId=e?.token?.user?.id,this.domainId=e?.token?.project?.domain?.id,a.log(this.domainId),this.regionsFromCatalog=[],o.auth.scope&&e?.token&&(this.catalog=e.token.catalog,this.endpoints={},this.catalog.forEach((e=>{const t=e.endpoints.find((e=>"public"===e.interface));t&&t.region_id===this.region&&(this.endpoints[e.type]=t.url),t&&"compute"===e.type&&(this.regionsFromCatalog.includes(t.region_id)||this.regionsFromCatalog.push(t.region_id))}))),this.regionsFromCatalog=this.regionsFromCatalog.map((e=>({id:e}))),e}catch(n){return a.error(n),{error:n}}}async getFlavors(e,t){return await this.getOptions(e,"/flavors","flavors",void 0,t)}async getImages(e,t){return await this.getOptions(e,"/images/detail","images",void 0,t)}async getKeyPairs(e,t){return await this.getOptions(e,"/os-keypairs","keypairs",(e=>e.keypair),t)}async getSecurityGroups(e,t){return await this.getOptions(e,"/os-security-groups","security_groups",void 0,t)}async getFloatingIpPools(e,t){return await this.getOptions(e,"/os-floating-ip-pools","floating_ip_pools",void 0,t)}async getNetworkNames(e,t){return await this.getOptions(e,"/os-tenant-networks","networks",(e=>({...e,name:e.label})),t)}async getAvailabilityZones(e,t){return await this.getOptions(e,"/os-availability-zone","availabilityZoneInfo",(e=>({...e,name:e.zoneName})),t)}async getOptions(e,t,s,a,o){e.busy=!0,e.enabled=!0,e.selected="";const i=await this.makeComputeRequest(t);if(i&&i[s]){let t=i[s]||[];if(a&&(t=t.map((e=>a(e)))),e.options=this.convertToOptions(t),e.busy=!1,o){const t=e.options.find((e=>e.value.id===o));t&&(e.selected=t.value)}!e.selected&&e.options.length>0&&(e.selected=e.options[0].value)}else e.options=[],e.selected=null,e.busy=!1,e.enabled=!1}async makeComputeRequest(e){const t=this.endpoints["compute"].replace(/^https?:\/\//,""),s=`/meta/proxy/${t}`,o=`${s}${e}`,i={Accept:"application/json","X-Auth-Token":this.token};try{const e=await this.$dispatch("management/request",{url:o,headers:i,method:"GET",redirectUnauthorized:!1},{root:!0});return e}catch(n){a.error(n)}}async getProjects(){const e=this.endpoint.replace(/^https?:\/\//,""),t=`/meta/proxy/${e}`,s={Accept:"application/json","X-Auth-Token":this.token};try{const e=await this.$dispatch("management/request",{url:`${t}/users/${this.userId}/projects`,headers:s,method:"GET",redirectUnauthorized:!1},{root:!0});return e?.projects}catch(o){return a.error(o),{error:o}}}async getRegions(){const e=this.endpoint.replace(/^https?:\/\//,""),t=`/meta/proxy/${e}`,s={Accept:"application/json","X-Auth-Token":this.token};try{const e=await this.$dispatch("management/request",{url:`${t}/regions`,headers:s,method:"GET",redirectUnauthorized:!1},{root:!0});return e?.regions}catch(o){return a.error(o),{error:o}}}convertToOptions(e){const t=(e||[]).sort(((e,t)=>e.name.localeCompare(t.name)));return t.map((e=>({label:e.name,value:e})))}}},3613:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var a=s(9274);const o=e=>((0,a.pushScopeId)("data-v-67d5891a"),e=e(),(0,a.popScopeId)(),e),i={key:1},n={class:"openstack-config"},r=o((()=>(0,a.createElementVNode)("div",{class:"title"}," Openstack Configuration ",-1))),l={key:0,class:"loading"},d=o((()=>(0,a.createElementVNode)("i",{class:"icon-spinner icon-spin icon-lg"},null,-1))),c=o((()=>(0,a.createElementVNode)("span",null," Authenticating with the Openstack server ... ",-1))),u=[d,c],p={class:"row mt-10"},h={class:"col span-6"},m={class:"col span-6"},g={class:"row mt-10"},v={class:"col span-6"},y={class:"col span-6"},f={class:"row mt-10"},b={class:"col span-6"};function k(e,t,s,o,d,c){const k=(0,a.resolveComponent)("Loading"),w=(0,a.resolveComponent)("Banner"),N=(0,a.resolveComponent)("LabeledSelect"),I=(0,a.resolveComponent)("LabeledInput");return(0,a.openBlock)(),(0,a.createElementBlock)("div",null,[e.$fetchState.pending?((0,a.openBlock)(),(0,a.createBlock)(k,{key:0,delayed:!0})):(0,a.createCommentVNode)("",!0),d.errors.length?((0,a.openBlock)(),(0,a.createElementBlock)("div",i,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(d.errors,((e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:t},[(0,a.createVNode)(w,{color:"error",label:c.stringify(e)},null,8,["label"])])))),128))])):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("div",null,[(0,a.createElementVNode)("div",n,[r,d.authenticating?((0,a.openBlock)(),(0,a.createElementBlock)("div",l,u)):(0,a.createCommentVNode)("",!0)]),(0,a.createElementVNode)("div",p,[(0,a.createElementVNode)("div",h,[(0,a.createVNode)(N,{value:d.flavors.selected,"onUpdate:value":t[0]||(t[0]=e=>d.flavors.selected=e),label:"Flavor",options:d.flavors.options,disabled:!d.flavors.enabled||s.busy,loading:d.flavors.busy,searchable:!1},null,8,["value","options","disabled","loading"])]),(0,a.createElementVNode)("div",m,[(0,a.createVNode)(N,{value:d.images.selected,"onUpdate:value":t[1]||(t[1]=e=>d.images.selected=e),label:"Image",options:d.images.options,disabled:!d.images.enabled||s.busy,loading:d.images.busy,searchable:!1},null,8,["value","options","disabled","loading"])])]),(0,a.createElementVNode)("div",g,[(0,a.createElementVNode)("div",v,[(0,a.createVNode)(N,{value:d.securityGroups.selected,"onUpdate:value":t[2]||(t[2]=e=>d.securityGroups.selected=e),label:"Security Groups",options:d.securityGroups.options,disabled:!d.securityGroups.enabled||s.busy,loading:d.securityGroups.busy,searchable:!1},null,8,["value","options","disabled","loading"])]),(0,a.createElementVNode)("div",y,[(0,a.createVNode)(N,{value:d.networks.selected,"onUpdate:value":t[3]||(t[3]=e=>d.networks.selected=e),label:"Networks",options:d.networks.options,disabled:!d.networks.enabled||s.busy,loading:d.networks.busy,searchable:!1},null,8,["value","options","disabled","loading"])])]),(0,a.createElementVNode)("div",f,[(0,a.createElementVNode)("div",b,[(0,a.createVNode)(I,{value:d.sshUser,"onUpdate:value":t[4]||(t[4]=e=>d.sshUser=e),mode:e.mode,disabled:s.busy,label:"SSH User ID",placeholder:"ubuntu"},null,8,["value","mode","disabled"])])])])])}var w=s(4409),N=s(9980),I=s(240),E=s(3527),O=s(1419),j=s(5664),C=s(9726),V=s(4220),$=s(4247),U=s(4364);function _(){return{options:[],selected:null,busy:!1,enabled:!1}}var S={components:{Banner:N.l,Loading:w.A,LabeledInput:O.o,LabeledSelect:E.A},mixins:[I.A],props:{uuid:{type:String,required:!0},cluster:{type:Object,default:()=>({})},credentialId:{type:String,required:!0},disabled:{type:Boolean,default:!1},busy:{type:Boolean,default:!1},provider:{type:String,required:!0}},async fetch(){if(this.errors=[],!this.credentialId)return;if(this.mode===V.nW)return void this.initForViewMode();try{this.credential=await this.$store.dispatch("rancher/find",{type:j.k$.CLOUD_CREDENTIAL,id:this.credentialId})}catch(t){this.credential=null}try{const e=this.credentialId.replace(":","/"),t=await this.$store.dispatch("management/find",{type:j.bB,id:e}),s=t.data["viarezocredentialConfig-password"],a=atob(s);this.password=a,this.ready=!0}catch(t){this.password="",U.error(t)}this.authenticating=!0;const e=new $.P(this.$store,this.credential);e.password=this.password,this.os=e,this.os.getToken().then((t=>{if(t.error)return this.authenticating=!1,this.$emit("validationChanged",!1),void this.errors.push("Unable to authenticate with the OpenStack server");this.authenticating=!1,e.getFlavors(this.flavors,this.value?.flavorName),e.getImages(this.images,this.value?.imageName),e.getSecurityGroups(this.securityGroups,this.value?.secGroups),e.getNetworkNames(this.networks,this.value?.netName)})),this.$emit("validationChanged",!0)},data(){return{authenticating:!1,ready:!1,os:null,password:null,flavors:_(),images:_(),securityGroups:_(),networks:_(),sshUser:this.value?.sshUser||"ubuntu",errors:null}},watch:{credentialId(){this.$fetch()}},methods:{stringify:C.As,initForViewMode(){this.fakeSelectOptions(this.flavors,this.value?.flavorId),this.fakeSelectOptions(this.images,this.value?.imageId),this.fakeSelectOptions(this.securityGroups,this.value?.secGroups),this.fakeSelectOptions(this.networks,this.value?.netId)},fakeSelectOptions(e,t){e.busy=!1,e.enabled=!1,e.options=[],t&&e.options.push({label:t,value:t}),e.selected=t},syncValue(){this.value.authUrl=this.os.endpoint,this.value.domainId=this.os.domainId,this.value.username=this.os.username,this.value.projectId=this.os.projectId,this.value.flavorId=this.flavors.selected?.id,this.value.imageId=this.images.selected?.id,this.value.netId=this.networks.selected?.id,this.value.secGroups=this.securityGroups.selected?.name,this.value.sshUser=this.sshUser,this.value.region=this.os.region,this.value.endpointType="publicURL",this.value.availabilityZone="nova",U.log(this.value)},test(){this.syncValue()}}},G=(s(8167),s(7433));const B=(0,G.A)(S,[["render",k],["__scopeId","data-v-67d5891a"]]);var x=B},407:function(e,t,s){"use strict";s.r(t);var a=s(6758),o=s.n(a),i=s(6173),n=s.n(i),r=n()(o());r.push([e.id,".file-button[data-v-67d5891a]{align-items:center;position:absolute;top:0;right:0;height:100%;display:flex}.file-button>.file-selector[data-v-67d5891a]{height:59px;border-top-left-radius:0;border-bottom-left-radius:0}.openstack-config[data-v-67d5891a]{display:flex;align-items:center}.openstack-config>.title[data-v-67d5891a]{font-weight:700;padding:4px 0}.openstack-config>.loading[data-v-67d5891a]{margin-left:20px;display:flex;align-items:center}.openstack-config>.loading>i[data-v-67d5891a]{margin-right:4px}",""]),t["default"]=r},8167:function(e,t,s){var a=s(407);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var o=s(4825).A;o("4652b18c",a,!0,{sourceMap:!1,shadowMode:!1})},1177:function(e,t,s){var a={"./csp/metadata.json":6471,"./federal/metadata.json":1862,"./rgs/metadata.json":8401,"./suse/metadata.json":7259};function o(e){var t=i(e);return s(t)}function i(e){if(!s.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}o.keys=function(){return Object.keys(a)},o.resolve=i,e.exports=o,o.id=1177}}]);
//# sourceMappingURL=node-driver-0.1.0.umd.min.machine-config.js.map