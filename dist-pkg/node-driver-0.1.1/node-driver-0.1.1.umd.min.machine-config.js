(("undefined"!==typeof self?self:this)["webpackJsonpnode_driver_0_1_1"]=("undefined"!==typeof self?self:this)["webpackJsonpnode_driver_0_1_1"]||[]).push([[2],{"0e1b":function(e,t,s){var i=s("3c10");t=i(!1),t.push([e.i,".file-button[data-v-d3c9438a]{align-items:center;position:absolute;top:0;right:0;height:100%;display:flex}.file-button>.file-selector[data-v-d3c9438a]{height:59px;border-top-left-radius:0;border-bottom-left-radius:0}.openstack-config[data-v-d3c9438a]{display:flex;align-items:center}.openstack-config>.title[data-v-d3c9438a]{font-weight:700;padding:4px 0}.openstack-config>.loading[data-v-d3c9438a]{margin-left:20px;display:flex;align-items:center}.openstack-config>.loading>i[data-v-d3c9438a]{margin-right:4px}",""]),e.exports=t},2890:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[e.$fetchState.pending?t("Loading",{attrs:{delayed:!0}}):e._e(),e.errors.length?t("div",e._l(e.errors,(function(s,i){return t("div",{key:i},[t("Banner",{attrs:{color:"error",label:e.stringify(s)}})],1)})),0):e._e(),t("div",[t("div",{staticClass:"openstack-config"},[t("div",{staticClass:"title"},[e._v(" Openstack Configuration ")]),e.authenticating?t("div",{staticClass:"loading"},[t("i",{staticClass:"icon-spinner icon-spin icon-lg"}),t("span",[e._v(" Authenticating with the Openstack server ... ")])]):e._e()]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Flavor",options:e.flavors.options,disabled:!e.flavors.enabled||e.busy,loading:e.flavors.busy,searchable:!1},model:{value:e.flavors.selected,callback:function(t){e.$set(e.flavors,"selected",t)},expression:"flavors.selected"}})],1),t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Image",options:e.images.options,disabled:!e.images.enabled||e.busy,loading:e.images.busy,searchable:!1},model:{value:e.images.selected,callback:function(t){e.$set(e.images,"selected",t)},expression:"images.selected"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Security Groups",options:e.securityGroups.options,disabled:!e.securityGroups.enabled||e.busy,loading:e.securityGroups.busy,searchable:!1},model:{value:e.securityGroups.selected,callback:function(t){e.$set(e.securityGroups,"selected",t)},expression:"securityGroups.selected"}})],1),t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Networks",options:e.networks.options,disabled:!e.networks.enabled||e.busy,loading:e.networks.busy,searchable:!1},model:{value:e.networks.selected,callback:function(t){e.$set(e.networks,"selected",t)},expression:"networks.selected"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledInput",{attrs:{mode:e.mode,disabled:e.busy,label:"SSH User"},model:{value:e.sshUser,callback:function(t){e.sshUser=t},expression:"sshUser"}})],1),t("div",{staticClass:"col span-6"},[t("LabeledInput",{attrs:{mode:e.mode,disabled:e.busy,label:"Volume Size (in GB)"},model:{value:e.volumeSize,callback:function(t){e.volumeSize=t},expression:"volumeSize"}})],1)]),t("div",{staticClass:"row mt-10"},[t("LabeledInput",{attrs:{mode:e.mode,disabled:e.busy,label:"Server Group Name"},model:{value:e.serverGroupName,callback:function(t){e.serverGroupName=t},expression:"serverGroupName"}})],1)])],1)},a=[],o=s("15ca"),n=s("6418"),r=s("305c"),l=s("466b"),d=s("8e93"),c=s("907c"),u=s("3e9d"),h=s("da25"),p=s("f2d8");function v(){return{options:[],selected:null,busy:!1,enabled:!1}}var m={components:{Banner:n["a"],Loading:o["a"],LabeledInput:d["a"],LabeledSelect:l["a"]},mixins:[r["a"]],props:{uuid:{type:String,required:!0},cluster:{type:Object,default:()=>({})},credentialId:{type:String,required:!0},disabled:{type:Boolean,default:!1},busy:{type:Boolean,default:!1},provider:{type:String,required:!0}},async fetch(){if(this.errors=[],!this.credentialId)return;if(this.mode===h["c"])return void this.initForViewMode();try{this.credential=await this.$store.dispatch("rancher/find",{type:c["c"].CLOUD_CREDENTIAL,id:this.credentialId})}catch(t){this.credential=null}try{const e=this.credentialId.replace(":","/"),t=await this.$store.dispatch("management/find",{type:c["e"],id:e}),s=t.data["viarezocredentialConfig-password"],i=atob(s);this.password=i,this.ready=!0}catch(t){this.password="",console.error(t)}this.authenticating=!0;const e=new p["a"](this.$store,this.credential);e.password=this.password,this.os=e,this.os.getToken().then(t=>{var s,i,a,o;if(t.error)return this.authenticating=!1,this.$emit("validationChanged",!1),void this.errors.push("Unable to authenticate with the OpenStack server");this.authenticating=!1,e.getFlavors(this.flavors,null===(s=this.value)||void 0===s?void 0:s.flavorName),e.getImages(this.images,null===(i=this.value)||void 0===i?void 0:i.imageName),e.getSecurityGroups(this.securityGroups,null===(a=this.value)||void 0===a?void 0:a.secGroups),e.getNetworkNames(this.networks,null===(o=this.value)||void 0===o?void 0:o.netName)}),this.$emit("validationChanged",!0)},data(){var e,t,s;return{authenticating:!1,ready:!1,os:null,password:null,flavors:v(),images:v(),securityGroups:v(),networks:v(),sshUser:(null===(e=this.value)||void 0===e?void 0:e.sshUser)||"ubuntu",volumeSize:(null===(t=this.value)||void 0===t?void 0:t.volumeSize)||"20",serverGroupName:(null===(s=this.value)||void 0===s?void 0:s.serverGroupName)||"",errors:null}},watch:{credentialId(){this.$fetch()}},methods:{stringify:u["b"],initForViewMode(){var e,t,s,i;this.fakeSelectOptions(this.flavors,null===(e=this.value)||void 0===e?void 0:e.flavorId),this.fakeSelectOptions(this.images,null===(t=this.value)||void 0===t?void 0:t.imageId),this.fakeSelectOptions(this.securityGroups,null===(s=this.value)||void 0===s?void 0:s.secGroups),this.fakeSelectOptions(this.networks,null===(i=this.value)||void 0===i?void 0:i.netId)},fakeSelectOptions(e,t){e.busy=!1,e.enabled=!1,e.options=[],t&&e.options.push({label:t,value:t}),e.selected=t},syncValue(){var e,t,s,i;this.value.authUrl=this.os.endpoint,this.value.domainId=this.os.domainId,this.value.projectId=this.os.projectId,this.value.flavorId=null===(e=this.flavors.selected)||void 0===e?void 0:e.id,this.value.imageId=null===(t=this.images.selected)||void 0===t?void 0:t.id,this.value.netId=null===(s=this.networks.selected)||void 0===s?void 0:s.id,this.value.secGroups=null===(i=this.securityGroups.selected)||void 0===i?void 0:i.name,this.value.sshUser=this.sshUser,this.value.region=this.os.region,this.value.serverGroupName=this.serverGroupName,this.value.volumeSize=this.volumeSize,this.value.endpointType="publicURL",this.value.availabilityZone="nova"},test(){this.syncValue()}}},g=m,f=(s("5e56"),s("2be6")),b=Object(f["a"])(g,i,a,!1,null,"d3c9438a",null);t["default"]=b.exports},"5e56":function(e,t,s){"use strict";s("d8e2")},d8e2:function(e,t,s){var i=s("0e1b");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var a=s("0ed3").default;a("b651a6a4",i,!0,{sourceMap:!1,shadowMode:!1})},dad7:function(e,t,s){var i={"./csp/metadata.json":"7f57","./federal/metadata.json":"66fa","./rgs/metadata.json":"45d2","./suse/metadata.json":"1d5f"};function a(e){var t=o(e);return s(t)}function o(e){if(!s.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=o,e.exports=a,a.id="dad7"},f2d8:function(e,t,s){"use strict";function i(e,t,s){return(t=a(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function a(e){var t=o(e,"string");return"symbol"==typeof t?t:t+""}function o(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}s.d(t,"a",(function(){return n}));class n{constructor(e,t){i(this,"domainId",""),i(this,"domainName",""),i(this,"endpoint",""),i(this,"projectDomainName",""),i(this,"projectId",""),i(this,"username",""),i(this,"password",""),i(this,"token",""),i(this,"region",""),i(this,"catalog",void 0),i(this,"endpoints",void 0),i(this,"userId",""),i(this,"$dispatch",void 0),i(this,"regionsFromCatalog",[]),t.annotations?Object.keys(t.annotations).forEach(e=>{const s=e.split("/");if(2===s.length&&"viarezo.cattle.io"===s[0]){const i=s[1];this[i]=t.annotations[e]}}):Object.keys(t).forEach(e=>{this[e]=t[e]}),this.$dispatch=e.dispatch}async getToken(){const e=this.endpoint.replace(/^https?:\/\//,""),t="/meta/proxy/"+e,s=t+"/auth/tokens",i={auth:{identity:{methods:["password"],password:{user:{name:this.username,domain:{name:this.domainName},password:this.password}}}}};this.projectId&&(i.auth.scope={project:{id:this.projectId}});const a={Accept:"application/json"};try{var o,n;const e=await this.$dispatch("management/request",{url:s,headers:a,method:"POST",redirectUnauthorized:!1,data:i},{root:!0});if(502===e._status)return{error:"Could not proxy request - URL may not be in Rancher's allow list"};const t=e._headers["x-subject-token"];return this.token=t,this.userId=null===e||void 0===e||null===(o=e.token)||void 0===o||null===(o=o.user)||void 0===o?void 0:o.id,this.domainId=null===e||void 0===e||null===(n=e.token)||void 0===n||null===(n=n.project)||void 0===n||null===(n=n.domain)||void 0===n?void 0:n.id,this.regionsFromCatalog=[],i.auth.scope&&null!==e&&void 0!==e&&e.token&&(this.catalog=e.token.catalog,this.endpoints={},this.catalog.forEach(e=>{const t=e.endpoints.find(e=>"public"===e.interface);t&&t.region_id===this.region&&(this.endpoints[e.type]=t.url),t&&"compute"===e.type&&(this.regionsFromCatalog.includes(t.region_id)||this.regionsFromCatalog.push(t.region_id))})),this.regionsFromCatalog=this.regionsFromCatalog.map(e=>({id:e})),e}catch(r){return console.error(r),{error:r}}}async getFlavors(e,t){return await this.getOptions(e,"/flavors","flavors",void 0,t)}async getImages(e,t){return await this.getOptions(e,"/images/detail","images",void 0,t)}async getKeyPairs(e,t){return await this.getOptions(e,"/os-keypairs","keypairs",e=>e.keypair,t)}async getSecurityGroups(e,t){return await this.getOptions(e,"/os-security-groups","security_groups",void 0,t)}async getFloatingIpPools(e,t){return await this.getOptions(e,"/os-floating-ip-pools","floating_ip_pools",void 0,t)}async getNetworkNames(e,t){return await this.getOptions(e,"/os-tenant-networks","networks",e=>({...e,name:e.label}),t)}async getAvailabilityZones(e,t){return await this.getOptions(e,"/os-availability-zone","availabilityZoneInfo",e=>({...e,name:e.zoneName}),t)}async getOptions(e,t,s,i,a){e.busy=!0,e.enabled=!0,e.selected="";const o=await this.makeComputeRequest(t);if(o&&o[s]){let t=o[s]||[];if(i&&(t=t.map(e=>i(e))),e.options=this.convertToOptions(t),e.busy=!1,a){const t=e.options.find(e=>e.value.id===a);t&&(e.selected=t.value)}!e.selected&&e.options.length>0&&(e.selected=e.options[0].value)}else e.options=[],e.selected=null,e.busy=!1,e.enabled=!1}async makeComputeRequest(e){const t=this.endpoints["compute"].replace(/^https?:\/\//,""),s="/meta/proxy/"+t,i=`${s}${e}`,a={Accept:"application/json","X-Auth-Token":this.token};try{const e=await this.$dispatch("management/request",{url:i,headers:a,method:"GET",redirectUnauthorized:!1},{root:!0});return e}catch(o){console.error(o)}}async getProjects(){const e=this.endpoint.replace(/^https?:\/\//,""),t="/meta/proxy/"+e,s={Accept:"application/json","X-Auth-Token":this.token};try{const e=await this.$dispatch("management/request",{url:`${t}/users/${this.userId}/projects`,headers:s,method:"GET",redirectUnauthorized:!1},{root:!0});return null===e||void 0===e?void 0:e.projects}catch(i){return console.error(i),{error:i}}}async getRegions(){const e=this.endpoint.replace(/^https?:\/\//,""),t="/meta/proxy/"+e,s={Accept:"application/json","X-Auth-Token":this.token};try{const e=await this.$dispatch("management/request",{url:t+"/regions",headers:s,method:"GET",redirectUnauthorized:!1},{root:!0});return null===e||void 0===e?void 0:e.regions}catch(i){return console.error(i),{error:i}}}convertToOptions(e){const t=(e||[]).sort((e,t)=>e.name.localeCompare(t.name));return t.map(e=>({label:e.name,value:e}))}}}}]);
//# sourceMappingURL=node-driver-0.1.1.umd.min.machine-config.js.map